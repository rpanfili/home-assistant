 # This automation script runs when a value is received via MQTT on retained topic: setTemperature
 # It sets the value slider on the GUI. This slides also had its own automation when the value is changed.
- alias: Set shutter slider
  hide_entity: True
  trigger:
    platform: mqtt
    topic: "catingham_palace/kitchen/left_rolling_shutter/position"
   # entity_id: input_slider.target_temp
  action:
     service: input_slider.select_value
     data_template:
      entity_id: input_slider.kitchen_left_rolling_shutter
      value: '{{ trigger.payload }}'

 # This automation script runs when the target temperature slider is moved.
 # It publishes its value to the same MQTT topic it is also subscribed to.
- alias: Shutter slider moved
  hide_entity: True
  trigger:
    platform: state
    entity_id: input_slider.kitchen_left_rolling_shutter
  action:
    service: mqtt.publish
    data_template:
      topic: "catingham_palace/kitchen/left_rolling_shutter/position/set"
      retain: true
      payload: '{{ states.input_slider.kitchen_left_rolling_shutter.state | int }}'

- alias: Set kitchen right shutter slider
  hide_entity: True
  trigger:
    platform: mqtt
    topic: "catingham_palace/kitchen/right_rolling_shutter/position"
  action:
     service: input_slider.select_value
     data_template:
      entity_id: input_slider.kitchen_right_rolling_shutter
      value: '{{ trigger.payload }}'

- alias: Kitchen right shutter slider moved
  hide_entity: True
  trigger:
    platform: state
    entity_id: input_slider.kitchen_right_rolling_shutter
  action:
    service: mqtt.publish
    data_template:
      topic: "catingham_palace/kitchen/right_rolling_shutter/position/set"
      retain: true
      payload: '{{ states.input_slider.kitchen_right_rolling_shutter.state | int }}'

- alias: Set green room shutter slider
  hide_entity: True
  trigger:
    platform: mqtt
    topic: "catingham_palace/green_room/rolling_shutter/position"
  action:
     service: input_slider.select_value
     data_template:
      entity_id: input_slider.green_room_rolling_shutter
      value: '{{ trigger.payload }}'

- alias: Green room shutter slider moved
  hide_entity: True
  trigger:
    platform: state
    entity_id: input_slider.green_room_rolling_shutter
  action:
    service: mqtt.publish
    data_template:
      topic: "catingham_palace/green_room/rolling_shutter/position/set"
      retain: true
      payload: '{{ states.input_slider.green_room_rolling_shutter.state | int }}'

- alias: Set pink room shutter slider
  hide_entity: True
  trigger:
    platform: mqtt
    topic: "catingham_palace/pink_room/rolling_shutter/position"
  action:
     service: input_slider.select_value
     data_template:
      entity_id: input_slider.pink_room_rolling_shutter
      value: '{{ trigger.payload }}'

- alias: Pink room shutter slider moved
  hide_entity: True
  trigger:
    platform: state
    entity_id: input_slider.pink_room_rolling_shutter
  action:
    service: mqtt.publish
    data_template:
      topic: "catingham_palace/pink_room/rolling_shutter/position/set"
      retain: true
      payload: '{{ states.input_slider.pink_room_rolling_shutter.state | int }}'

- alias: Set bedroom shutter slider
  hide_entity: True
  trigger:
    platform: mqtt
    topic: "catingham_palace/bedroom/rolling_shutter/position"
  action:
     service: input_slider.select_value
     data_template:
      entity_id: input_slider.bedroom_rolling_shutter
      value: '{{ trigger.payload }}'

- alias: Bedroom shutter slider moved
  hide_entity: True
  trigger:
    platform: state
    entity_id: input_slider.bedroom_rolling_shutter
  action:
    service: mqtt.publish
    data_template:
      topic: "catingham_palace/bedroom/rolling_shutter/position/set"
      retain: true
      payload: '{{ states.input_slider.bedroom_rolling_shutter.state | int }}'

- alias: Set bathroom shutter slider
  hide_entity: True
  trigger:
    platform: mqtt
    topic: "catingham_palace/bathroom/rolling_shutter/position"
  action:
     service: input_slider.select_value
     data_template:
      entity_id: input_slider.bathroom_rolling_shutter
      value: '{{ trigger.payload }}'

- alias: Bathroom shutter slider moved
  hide_entity: True
  trigger:
    platform: state
    entity_id: input_slider.bathroom_rolling_shutter
  action:
    service: mqtt.publish
    data_template:
      topic: "catingham_palace/bathroom/rolling_shutter/position/set"
      retain: true
      payload: '{{ states.input_slider.bathroom_rolling_shutter.state | int }}'

- alias: Set living room left shutter slider
  hide_entity: True
  trigger:
    platform: mqtt
    topic: "catingham_palace/living_room/left_rolling_shutter/position"
  action:
     service: input_slider.select_value
     data_template:
      entity_id: input_slider.living_room_left_rolling_shutter
      value: '{{ trigger.payload }}'

- alias: Living room left shutter slider moved
  hide_entity: True
  trigger:
    platform: state
    entity_id: input_slider.living_room_left_rolling_shutter
  action:
    service: mqtt.publish
    data_template:
      topic: "catingham_palace/living_room/left_rolling_shutter/position/set"
      retain: true
      payload: '{{ states.input_slider.living_room_left_rolling_shutter.state | int }}'


- alias: Set living room right shutter slider
  hide_entity: True
  trigger:
    platform: mqtt
    topic: "catingham_palace/living_room/right_rolling_shutter/position"
  action:
     service: input_slider.select_value
     data_template:
      entity_id: input_slider.living_room_right_rolling_shutter
      value: '{{ trigger.payload }}'

- alias: Living room right shutter slider moved
  hide_entity: True
  trigger:
    platform: state
    entity_id: input_slider.living_room_right_rolling_shutter
  action:
    service: mqtt.publish
    data_template:
      topic: "catingham_palace/living_room/right_rolling_shutter/position/set"
      retain: true
      payload: '{% if is_state("automation.leave_cat_passage_living_room","on") %}{{ (states.input_slider.living_room_right_rolling_shutter.state | int, states.input_slider.cat_passage.state | int) | max }}{% else %}{{ states.input_slider.living_room_right_rolling_shutter.state | int }}{% endif %}'

- id: 'leave_cat_passage_living_room'
  alias: 'Leave cat passage living room'
  trigger:
    - platform: state
      entity_id: automation.leave_cat_passage_living_room
      to: 'on'
    #- platform: numeric_state
    #  entity_id: input_slider.living_room_right_rolling_shutter
    #  below: '{{ float(states.input_slider.cat_passage.state) }}'
    - platform: template
      value_template: "{{ float(states.input_slider.living_room_right_rolling_shutter.state) < float(states.input_slider.cat_passage.state) }}"
  condition:
    #condition: numeric_state
    #entity_id: input_slider.living_room_right_rolling_shutter
    #below: '{{ float(states.input_slider.cat_passage.state) }}'
    condition: template
    value_template: "{{ float(states.input_slider.living_room_right_rolling_shutter.state) < float(states.input_slider.cat_passage.state) }}"
  action:
    - service: input_slider.select_value
      data_template:
        entity_id: input_slider.living_room_right_rolling_shutter
        #value: 95
        value: '{{ (states.input_slider.cat_passage.state | int) }}'


- alias: 'Telegram bot that reply pong to ping'
  hide_entity: true
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/ping'
  action:
    - service: notify.catinghampalacebot
      data:
        message: 'pong'

- alias: 'Update Available Notifications'
  hide_entity: True
  trigger:
    platform: state
    entity_id: updater.updater
  action:
    - service: notify.catinghampalacebot
      data:
        message: 'A new update for Home Assistant is available.'

