---
id: "ECAA0EA1-1B95-4473-A245-FB309E025CA0"
alias: "energy_power_alert"
description: "Notifies power compsuntion over threshold"
initial_state: True
trigger:
  platform: numeric_state
  entity_id: sensor.total_power
  value_template: "{{ (state.state | float) - (states('input_number.power_alert_threshold') | float) }}"
  above: 0
  for: "00:00:10"
action:
  - service: notify.catinghampalacebot
    data_template:
      message: |-
        ðŸ™ **Consumo elettrico**: {{ states('sensor.total_power') | int }} W
        ðŸˆ {{ states('sensor.power1') | int }} W | ðŸ‘µðŸ» {{ states('sensor.power2') | int }} W
        {{ [
          'Cudiaul! Schepa giÃ² che se no chi le sciopa su tuch coss',
          'Smorza giÃ², crist!',
          'Va che te fa salta giÃ¹ la curent',
          'Te paghei te i bulett?'
          'TÃ©! Va che la custa la curent!'
        ] | random }}
  - condition: template
    value_template: '{{ (4500 * 0.9) > (states("sensor.total_power")|float) }}'
  - service: notify.alexa_media
    data_template:
      data:
        type: tts
        method: speak
      message: "Attenzione! State consumando {{states('sensor.total_power')|int}} watt, rischia di saltare la luce!"
      target:
        - media_player.laboratorio
        - media_player.cucina
